这一节我们讨论求非齐次方程特解的第二种方法，称为参数变分法（`variation of parameters`），由拉格朗日提出，是待定系数法的补充。参数变分法的主要优势是这是一种通用方法，可以用于任意方程，无需假定特解的形式。在本节最后我们会推导任意二阶线性非齐次微分方程的特解公式。另一方面，参数变分法最后需要对涉及非齐次项的积分，这可能非常困难。

例 1 求
$$y''+4y=8\tan t,-\pi/2<t<\pi/2\tag{1}$$
的通解。

解：这个问题无法使用待定系数法，因为非齐次项 $g(t)=\tan t$ 不是正弦和余弦函数的和或者积。

我们先求解对应齐次方程的通解
$$y''+4y=0\tag{2}$$
的特征方程是复根，因此通解是
$$y_c(t)=c_1\cos 2t+c_2\sin 2t\tag{3}$$
参数变分法的主要想法和 3.4 小节的降阶法类似。用 $u_1(t),u_2(t)$ 代替 $c_1,c_2$，那么有
$$y=u_1(t)\cos 2t+u_2(t)\sin 2t\tag{4}$$
这是 $(1)$ 的解，不过需要计算得到 $u_1(t),u_2(t)$。将 $(4)$ 代入 $(1)$ 求解。不过无需计算出结果，最后的方程会涉及两个未知函数 $u_1,u_2$ 及其一阶导、二阶导。由于只有一个方程，我们必须再强加一个条件，这样才有两个方程来求解未知函数 $u_1,u_2$。下面是拉格朗日提出的方法，我们选择的条件能够大大简化计算。

回到 $(4)$，求导得到
$$y'=-2u_1(t)\sin 2t+2u_2(t)\cos 2t+u_1'(t)\cos 2t+u_2'(t)\sin 2t\tag{5}$$
这里令上式的后两项之和为零，即
$$u_1'(t)\cos 2t+u_2'(t)\sin 2t=0\tag{6}$$
那么 $(5)$ 简化为
$$y'=-2u_1(t)\sin 2t+2u_2(t)\cos 2t\tag{7}$$
条件 $(6)$ 的最终影响还不确定，但是移出涉及 $u_1',u_2'$ 的项大大简化了 $y'$。对 $(7)$ 求导得到
$$y''=-4u_1(t)\cos 2t-4u_2(t)\sin 2t-2u_1'(t)\sin 2t+2u_2'(t)\cos 2t\tag{8}$$
将 $(4),(8)$ 代入 $(1)$ 得到
$$\begin{aligned}
y''+4y=&-4u_1(t)\cos 2t-4u_2(t)\sin 2t-2u_1'(t)\sin 2t+2u_2'(t)\cos 2t\\
&+4u_1(t)\cos 2t+4u_2(t)\sin 2t=8\tan t
\end{aligned}$$
因此 $u_1,u_2$ 需要满足
$$-2u_1'(t)\sin 2t+2u_2'(t)\cos 2t=8\tan t\tag{9}$$
联立方程 $(6),(9)$ 就可以得到 $u_1',u_2'$。一种解法是根据 $(6)$ 用 $u_1'(t)$ 来表示 $u_2'(t)$
$$u_2'(t)=-u_1'(t)\frac{\cos 2t}{\sin 2t}\tag{10}$$
将上式代入 $(9)$ 简化得到
$$u_1'(t)=-\frac{8\tan t\sin 2t}{2}=-8\sin^2 t\tag{11}$$
将 $u_1'(t)$ 代入 $(10)$ 并再次利用倍角公式得到
$$u_1'(t)=\frac{8\sin^2 t\cos 2t}{\sin 2t}=4\frac{\sin t(2\cos^2 t-1)}{\cos t}=4\sin t\bigg(2\cos t-\frac{1}{\cos t}\bigg)\tag{12}$$
现在有了 $u_1',u_2'$，积分得到
$$u_1(t)=4\sin t\cos t-4t+c_1\tag{13}$$
$$u_2(t)=4\ln(\cos t)-4\cos^2 t+c_2\tag{14}$$
代入 $(4)$ 得到通解
$$y=(4\sin t\cos t-4t)\cos 2t+(4\ln(\cos t)-4\cos^2 t)\sin 2t+c_1\cos 2t+c_2\sin 2t$$
最后再使用倍角公式简化得到
$$y=-2\sin 2t-4t\cos 2t+4\ln(\cos t)\sin 2t+c_1\cos 2t+c_2\sin 2t\tag{15}$$
上式中涉及任意常量 $c_1,c_2$ 是对应齐次方程的通解，前面三项是非齐次方程 $(1)$ 的特解。$(15)$ 是通解。

在上面的例子中，我们选择 $c_1,c_2$ 都为零作为特解。其实任意选择都能得到特解。如果选择 $c_1=0,c_2=2$，那么特解仅有两项
$$-4t\cos 2t+4\ln(\cos t)\sin 2t$$
特解的形式相对比较复杂，这就是为什么无法使用待定系数法的原因。

下面讨论一般情况。
$$y''+p(t)y'+q(t)y=g(t)\tag{16}$$
其中 $p,q,g$ 是连续函数。假定我们已经得到了相应的齐次方程
$$y''+p(t)y'+q(t)y=0\tag{17}$$
的通解是
$$y_c(t)=c_1y_1(t)+c_2y_2(t)\tag{18}$$
目前我们已经分析了 $(17)$ 中系数是常数的情况，第五章会分析系数依赖于 $t$ 的情况。

将 $(18)$ 中的 $c_1,c_2$ 换成 $u_1(t),u_2(t)$ 得到
$$y=u_1(t)y_1(t)+u_2(t)y_2(t)\tag{19}$$
下面尝试确定 $u_1(t),u_1(t)$，那么 $(19)$ 是非齐次方程 $(16)$ 的解。首先对 $(19)$ 求一阶导
$$y'=u_1'(t)y_1(t)+u_1(t)y_1'(t)+u_1'(t)y_2(t)+u_2(t)y_2'(t)\tag{20}$$
和例 1 一样，令
$$u_1'(t)y_1(t)+u_2'(t)y_2(t)=0\tag{21}$$
那么 $(20)$ 简化为
$$y'=u_1(t)y_1'(t)+u_2(t)y_2'(t)\tag{22}$$
再次求导得到
$$y''=u_1'(t)y_1'(t)+u_1(t)y_1''(t)+u_2'(t)y_2'(t)+u_2(t)y_2''(t)\tag{23}$$
将 $(19),(22),(23)$ 代入 $(16)$ 得到
$$\begin{aligned}
&u_1(t)(y_1''(t)+p(t)y_1'(t)+q(t)y_1(t))\\
+&u_2(t)(y_2''(t)+p(t)y_2'(t)+q(t)y_2(t))\\
+&u_1'(t)y_1'(t)+u_2'(t)y_2'(t)\\
=&g(t)
\end{aligned}\tag{24}$$
由于 $y_1,y_2$ 是齐次方程 $(18)$ 的解，那么 $(24)$ 中前两行为零。那么 $(24)$ 简化为
$$u_1'(t)y_1'(t)+u_2'(t)y_2'(t)=g(t)\tag{25}$$
$(21),(25)$ 构成了 $u_1'(t),u_2'(t)$ 的线性系统。求解得到
$$u_1'(t)=-\frac{y_2(t)g(t)}{W[y_1,y_2](t)},u_2'(t)=\frac{y_1(t)g(t)}{W[y_1,y_2](t)}\tag{26}$$
由于 $y_1,y_2$ 是基础解系，因此朗斯基 $W[y_1,y_2]$ 不为零。对 $(26)$ 积分得到
$$u_1(t)=-\int\frac{y_2(t)g(t)}{W[y_1,y_2](t)} dt+c_1,u_2(t)=\int\frac{y_1(t)g(t)}{W[y_1,y_2](t)} dt+c_2\tag{27}$$
如果 $(27)$ 能够表达成初等函数，那么代回 $(19)$ 得到 $(16)$ 的通解。不过一般情况都是无法表达这个积分。

**定理 3.6.1**
> 非齐次二阶线性微分方程
> $$y''+p(t)y'+q(t)y=g(t)\tag{28}$$
> 如果 $p,q,g$ 在开区间 $I$ 上是连续函数，且如果 $y_1,y_2$ 是相应的齐次微分方程
> $$y''+p(t)y'+q(t)y=0\tag{29}$$
> 的基础解析，那么 $(28)$ 的特解是
> $$Y(t)=-y_1(t)\int_{t_0}^t\frac{y_2(s)g(s)}{W[y_1,y_2](s)}ds+y_2(t)\int_{t_0}^t\frac{y_1(s)g(s)}{W[y_1,y_2](s)}ds\tag{30}$$
> 其中 $t_0$ 是 $I$ 内任意的合适的选择。根据定理 3.5.2 通解是
> $$y=c_1y_1(t)+c_2y_2(t)+Y(t)\tag{31}$$

根据表达式 $(30)$ 可以看出来参数变分法的两个主要困难。第一个是当齐次方程的系数不是常数时，求解基础解系 $y_1(t),y_2(t)$ 比较困难。第二个是求解 $(30)$ 中的积分，被积分式子涉及 $y_1,y_2,g$。在使用公式 $(30)$ 的时候，需要保证微分方程的形式如 $(28)$，否则 $g(t)$ 可能不是正确形式。

参数变分法的一个优势是 $(30)$ 为特解 $Y(t)$ 提供了一个关于任意外力函数 $g(t)$ 的表达式。如果想研究外力函数变化的影响，或者分析对于不同外力函数系统的响应，这个表达式是一个很好的开始。

从 $(30)$ 我们可以得到另一个特解形式是
$$Y(t)=\int_{t_0}^t\frac{y_1(s)y_2(t)-y_1(t)y_2(s)}{y_1(s)y_2'(s)-y_1'(s)y_2(s)} g(s)ds$$
