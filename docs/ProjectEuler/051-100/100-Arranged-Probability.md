[Problem 100](https://projecteuler.net/problem=100 "Problem 100 - Project Euler")  

如果一个盒子里有 21 个有色的碟子，15 个蓝色的和 6 个红色的。从中随机取两个，可知取到两个蓝碟子的几率是 $P(BB) = (15/21)\times(14/20) = 1/2$。

下一个满足此条件（即随机取两个碟子的情况下取到两个蓝色碟子的几率是 50%）的情况是  85个蓝碟子和 35 个红碟子。

对于包含超过 $10 ^ {12} = 1,000,000,000,000$ 个碟子的情况中，存在满足上述条件的并包含最少碟子的情况，该情况下共需要多少个蓝碟子？

假设碟子总数是 $T$，蓝色盘子总数是 $B$，那么它们需要满足 $(B/T)((B-1)/(T-1)) = 1/2$。

可以转化为求方程  
$$(T - 1/2) ^ 2 + 2 \times (B - 1/2) ^ 2 = -1/4$$
的整数解。

两边同时乘以 4
$$(T/2 - 1/4) ^ 2 + 2 \times (B/2 - 1/4) ^ 2 = -1$$
令
$$T = \frac{x+1}{2},B = \frac{y+1}{2}$$
其中，$x, y$ 是奇数。

方程转化为
$$x ^2 - 2 \times y ^ 2 = -1$$
这是一个 Pell 方程，最小的正整数解是
$$x = 1,y = 1$$
根据 Pell 方程的通解
$$\begin{cases}
x_n=\frac 1 2\left[ {(x_1+\sqrt d y_1)}^{2n-1} + {(x_1-\sqrt d y_1)}^{2n-1}\right] \\
y_n=\frac 1 {2\sqrt d }\left[ {(x_1+\sqrt d y_1)}^{2n-1} - {(x_1-\sqrt d y_1)}^{2n-1}\right]
\end{cases}$$
可以算出整数解，不难看出，$x(n), y(n)$ 都是奇数。

用程序计算得到第一个超过 $2 \times 10 ^ {12}$ 的 $x$，这样对应满足题意 $T$，通过对应的 $y$ 计算得到我们要求的答案 $B$。

公式里的 $d$ 是 2。
``` csharp
double sqrt2 = Math.Sqrt(2);

for (int i = 1; ; i++)
{
    long x = (long)((Math.Pow(1 + sqrt2, 2 * i - 1) + Math.Pow(1 - sqrt2, 2 * i - 1)) / 2) + 1;
    long y = (long)((Math.Pow(1 + sqrt2, 2 * i - 1) - Math.Pow(1 - sqrt2, 2 * i - 1)) / 2 / sqrt2) + 1;

    if (x > 2000000000000)
    {
        return (y + 1) / 2;
    }
}
```

程序中，在计算 `x` 和 `y` 的时候都 `+1` 了，因为前面的 `double` 类型运算可能会损失精度，强转成 `long` 的时候少了 1，所以最后又加了个 1。
